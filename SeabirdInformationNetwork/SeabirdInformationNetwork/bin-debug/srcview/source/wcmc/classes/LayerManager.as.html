<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>LayerManager.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">wcmc</span>.<span class="ActionScriptDefault_Text">classes</span>
<span class="ActionScriptASDoc">/**
*Provides a central object for managing all of the ArcGIS Server layers in an application 
*/</span>
<span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">Map</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">Map3D</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">MapType</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span>.<span class="ActionScriptDefault_Text">ArcGISMapOverlay</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span>.<span class="ActionScriptDefault_Text">ArcGISMapOverlayOptions</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span>.<span class="ActionScriptDefault_Text">ArcGISTileLayer</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span>.<span class="ActionScriptDefault_Text">ArcGISTileLayerOptions</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span>.<span class="ActionScriptDefault_Text">ArcGISTileLayerOverlay</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span>.<span class="ActionScriptDefault_Text">MapService</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span>.<span class="ActionScriptDefault_Text">ServiceEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">interfaces</span>.<span class="ActionScriptDefault_Text">IOverlay</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">controls</span>.<span class="ActionScriptDefault_Text">Alert</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">core</span>.<span class="ActionScriptDefault_Text">Application</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptDefault_Text">ItemClickEvent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span>.<span class="ActionScriptDefault_Text">managers</span>.<span class="ActionScriptDefault_Text">CursorManager</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">LayerManager</span>
    <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">LayerManager</span><span class="ActionScriptBracket/Brace">()</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;ChangeLayerVisiblity&quot;</span>,<span class="ActionScriptDefault_Text">layerVisibilityChanged</span><span class="ActionScriptBracket/Brace">)</span>;        
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Map</span>;
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">()</span>;
        <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">layerVisibilityChanged</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ChangeLayerVisibilityEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setLayerVisible</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">else</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">setLayerHidden</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setLayerVisible</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
        <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_mapService</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">mapServiceUrl</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">mapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_mapService</span>;
            <span class="ActionScriptDefault_Text">CursorManager</span>.<span class="ActionScriptDefault_Text">setBusyCursor</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">_mapService</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">LOAD</span>,<span class="ActionScriptDefault_Text">checkMapServiceType</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_mapService</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_START</span>,<span class="ActionScriptDefault_Text">serviceevent_exportmapstart</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_mapService</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_COMPLETE</span>,<span class="ActionScriptDefault_Text">serviceevent_exportmapcomplete</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">_mapService</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">ERROR</span>,<span class="ActionScriptDefault_Text">serviceevent_error</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">checkMapServiceType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">singleFusedMapCache</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ms</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">data</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MapService</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_ms</span>.<span class="ActionScriptDefault_Text">getLayers</span><span class="ActionScriptBracket/Brace">()</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ArcGISTileLayer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArcGISTileLayer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArcGISTileLayer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">mapServiceUrl</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArcGISTileLayerOptions</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptBracket/Brace">}))</span>;
                    <span class="ActionScriptDefault_Text">_ArcGISTileLayer</span>.<span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layer</span>; <span class="ActionScriptComment">//I had to add this property to be able to link the ArcGISTileLayer and the IOverlay to the Layer instance
</span>                    <span class="ActionScriptDefault_Text">_ArcGISTileLayer</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">LOAD</span>, <span class="ActionScriptDefault_Text">addOverlay</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptComment">// there are some serious issues with dynamic layers that do not seem to occur with cached maps for some reason - it seems to be related to the current extent and if 
</span>                    <span class="ActionScriptComment">// if crosses the international date line. If the extent includes the IDL, then a dynamic layer will not display!!
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_IOverlay</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArcGISMapOverlay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArcGISMapOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">mapServiceUrl</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArcGISMapOverlayOptions</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptBracket/Brace">}))</span>;
                    <span class="ActionScriptDefault_Text">_IOverlay</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_START</span>,<span class="ActionScriptDefault_Text">serviceevent_exportmapstart</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_IOverlay</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_COMPLETE</span>,<span class="ActionScriptDefault_Text">serviceevent_exportmapcomplete</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_IOverlay</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_LOAD</span>, <span class="ActionScriptDefault_Text">serviceevent_exportmapload</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_IOverlay</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">ERROR</span>,<span class="ActionScriptDefault_Text">serviceevent_error</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">map</span>.<span class="ActionScriptDefault_Text">addOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_IOverlay</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">overlay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_IOverlay</span>;
                    <span class="ActionScriptDefault_Text">CursorManager</span>.<span class="ActionScriptDefault_Text">removeBusyCursor</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">serviceevent_exportmapstart</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> 
            <span class="ActionScriptBracket/Brace">{</span>
<span class="ActionScriptComment">//                CursorManager.setBusyCursor();
</span>                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;serviceevent_exportmapstart:&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Date</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">time</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">serviceevent_exportmapcomplete</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> 
            <span class="ActionScriptBracket/Brace">{</span>
<span class="ActionScriptComment">//                CursorManager.removeBusyCursor();
</span>                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;serviceevent_exportmapcomplete:&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Date</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">time</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">serviceevent_exportmapload</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;serviceevent_exportmapload:&quot;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Date</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">time</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">serviceevent_error</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">details</span>.<span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">Alert</span>.<span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">data</span>.<span class="ActionScriptDefault_Text">details</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;                        
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">CursorManager</span>.<span class="ActionScriptDefault_Text">removeBusyCursor</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptBracket/Brace">}</span>
           <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptComment">//for tiled layers
</span>            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_IOverlay</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IOverlay</span>;
                <span class="ActionScriptDefault_Text">_IOverlay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArcGISTileLayerOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ArcGISTileLayer</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_IOverlay</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_START</span>,<span class="ActionScriptDefault_Text">serviceevent_exportmapstart</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_IOverlay</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_COMPLETE</span>,<span class="ActionScriptDefault_Text">serviceevent_exportmapcomplete</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">_IOverlay</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_LOAD</span>, <span class="ActionScriptDefault_Text">serviceevent_exportmapload</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">map</span>.<span class="ActionScriptDefault_Text">addOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_IOverlay</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">CursorManager</span>.<span class="ActionScriptDefault_Text">removeBusyCursor</span><span class="ActionScriptBracket/Brace">()</span>;
                <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ArcGISTileLayer</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">overlay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_IOverlay</span>;
                <span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">target</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">LOAD</span>, <span class="ActionScriptDefault_Text">addOverlay</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setLayerHidden</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">overlay</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">map</span>.<span class="ActionScriptDefault_Text">removeOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">overlay</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">overlay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getMapServiceURL</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_IOverlay</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IOverlay</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mapService</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span>;
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">((</span><span class="ActionScriptDefault_Text">_IOverlay</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">className</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;ArcGISTileLayer&quot;</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ArcGISTileLayer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArcGISTileLayer</span><span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_IOverlay</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ArcGISTileLayer</span>;
                        <span class="ActionScriptDefault_Text">mapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_ArcGISTileLayer</span>.<span class="ActionScriptDefault_Text">getMapService</span><span class="ActionScriptBracket/Brace">()</span>;
                        <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptString">&quot;ArcGISMapOverlay&quot;</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ArcGISMapOverlay</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArcGISMapOverlay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_IOverlay</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ArcGISMapOverlay</span>;
                        <span class="ActionScriptDefault_Text">mapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_ArcGISTileLayer</span>.<span class="ActionScriptDefault_Text">getMapService</span><span class="ActionScriptBracket/Brace">()</span>;
                        <span class="ActionScriptReserved">break</span>;                        
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">mapService</span>.<span class="ActionScriptDefault_Text">getMapService</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">url</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setGoogleMapType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ItemClickEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Map3D</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">Application</span>.<span class="ActionScriptDefault_Text">application</span>.<span class="ActionScriptDefault_Text">map</span>;
                <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>.<span class="ActionScriptDefault_Text">item</span>.<span class="ActionScriptDefault_Text">mapType</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//take action depending on the base map set
</span>                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">EnumGoogleMapType</span>.<span class="ActionScriptDefault_Text">GOOGLE_IMAGERY</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                          <span class="ActionScriptDefault_Text">map</span>.<span class="ActionScriptDefault_Text">setMapType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapType</span>.<span class="ActionScriptDefault_Text">HYBRID_MAP_TYPE</span><span class="ActionScriptBracket/Brace">)</span>;
                          <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">EnumGoogleMapType</span>.<span class="ActionScriptDefault_Text">GOOGLE_ROAD</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                          <span class="ActionScriptDefault_Text">map</span>.<span class="ActionScriptDefault_Text">setMapType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapType</span>.<span class="ActionScriptDefault_Text">NORMAL_MAP_TYPE</span><span class="ActionScriptBracket/Brace">)</span>;
                          <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">case</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">EnumGoogleMapType</span>.<span class="ActionScriptDefault_Text">GOOGLE_TERRAIN</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                          <span class="ActionScriptDefault_Text">map</span>.<span class="ActionScriptDefault_Text">setMapType</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapType</span>.<span class="ActionScriptDefault_Text">PHYSICAL_MAP_TYPE</span><span class="ActionScriptBracket/Brace">)</span>;
                          <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
