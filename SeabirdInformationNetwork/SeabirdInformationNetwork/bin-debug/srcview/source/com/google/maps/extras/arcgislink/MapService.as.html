<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>MapService.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/*
 * ArcGIS for Google Maps Flash API
 *
 * License http://www.apache.org/licenses/LICENSE-2.0
 */</span>
 <span class="ActionScriptASDoc">/**
 * @author nianwei at gmail dot com
 */</span> 

<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span> <span class="ActionScriptBracket/Brace">{</span>
  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptOperator">*</span>;
  
  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptOperator">*</span>;

  <span class="ActionScriptASDoc">/**
   * This class is the core class for all map service operations.
   * It represents an  Server map service and serve as the underline resource
   * represented by  ArcGISTileLayer and  ArcGISMapOverlay.
   * It is constructed asynchronously so it should be used &lt;b&gt;after&lt;/b&gt;
   * it is loaded, either by handle its &quot;load&quot; event, or used in a callback function
   * passed in the constructor.
   * &lt;br/&gt;For more info see &lt;a  href  = &apos;http://resources.esri.com/help/9.3/arcgisserver/apis/rest/mapserver.html&apos;&gt;Map Service&lt;/a&gt;

   * &lt;p&gt;Creates a ArcGISMapService objects that can be used by UI components.
   * &lt;ul&gt;&lt;li&gt; &lt;code&gt; url&lt;/code&gt; (required) is the URL of the map servive, e.g. &lt;code&gt;
   * http://server.arcgisonline.com//rest/services/ESRI_StreetMap_World_2D/MapServer&lt;/code&gt;.
   * &lt;li&gt; &lt;code&gt;opt_service&lt;/code&gt; optional parameter of type ArcGISMapServiceOptions
   * &lt;ul/&gt; Note the spatial reference of the map service must already exists
   * in the ArcGISSpatialReferences if actual coordinates transformation is needed.
   * @name ArcGISMapService
   * @class @param {String} url
   * @param {ArcGISMapServiceOptions} opt_service
   * @property {String} [url] map service URL
   * @property {String} [name] map service Name, taken as part of URL.
   * @property {String} [serviceDescription] serviceDescription
   * @property {String} [mapName] map frame Name inside the map document
   * @property {String} [description] description
   * @property {String} [copyrightText] copyrightText
   * @property {Boolean} [singleFusedMapCache] if map cache is singleFused
   * @property {TileInfo} [tileInfo] See {@link ArcGISTileInfo}
   * @property {Envelope} [initialExtent] initialExtent, see {@link ArcGISEnvelope}
   * @property {Envelope} [fullExtent] fullExtent, see {@link ArcGISEnvelope}
   * @property {String} [units] unit
   * @property {Object} [documentInfo] Object with the folloing properties: &lt;code&gt;Title, Author,Comments,Subject,Category,Keywords&lt;/code&gt;
   */</span>
  <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">dynamic</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">MapService</span> <span class="ActionScriptReserved">implements</span> <span class="ActionScriptDefault_Text">IEventDispatcher</span> <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">copyrightText</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">documentInfo</span><span class="ActionScriptOperator">:*</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fullExtent</span><span class="ActionScriptOperator">:*</span>; <span class="ActionScriptComment">// maybe should be envelope, but object literal for now
</span>    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">initialExtent</span><span class="ActionScriptOperator">:*</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mapName</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">serviceDescription</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">singleFusedMapCache</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">units</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>;

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">loaded_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">correct_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">opt_service</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapServiceOptions</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptDefault_Text">dispatcher_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">EventDispatcher</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptDefault_Text">opt_service</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">opt_service</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MapServiceOptions</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">url</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">tks</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">url</span>.<span class="ActionScriptDefault_Text">split</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&quot;/&quot;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">opt_service</span>.<span class="ActionScriptDefault_Text">name</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">tks</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">tks</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">-</span> 2<span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">replace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">_</span><span class="ActionScriptOperator">/</span><span class="ActionScriptDefault_Text">g</span>, <span class="ActionScriptString">&apos; &apos;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">me</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">loaded_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">correct_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
      <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">restRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span>, <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;json&apos;</span><span class="ActionScriptBracket/Brace">}</span>, <span class="ActionScriptReserved">this</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">init_</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span>, <span class="ActionScriptDefault_Text">opt_service</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">})</span>;

    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptASDoc">/**
     * initialize an  Map Service from the meta data information.
     * The &lt;code&gt;json&lt;/code&gt; parameter is the json object returned by Map Service.
     * @private
     * @param {Object} json
     * @param {ArcGISMapServiceOptions} opt_service
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">init_</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span>, <span class="ActionScriptDefault_Text">opt_service</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">me</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>;
      <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">doneLoad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">loaded_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">layers_</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">layers_</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
          <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">subLayerIds</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">subLayers</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[]</span>;
            <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">jc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">subLayerIds</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">jc</span>; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
              <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">subLayer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">getLayer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">subLayerIds</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">])</span>;
              <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">subLayers</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">subLayer</span><span class="ActionScriptBracket/Brace">)</span>;
              <span class="ActionScriptDefault_Text">subLayer</span>.<span class="ActionScriptDefault_Text">parentLayer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layer</span>;
            <span class="ActionScriptBracket/Brace">}</span>
          <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptComment">// some  bad services will have an initial extent outside fullextent;
</span>        <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">initialExtent</span>.<span class="ActionScriptDefault_Text">xmin</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">initialExtent</span>.<span class="ActionScriptDefault_Text">xmin</span>, <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">fullExtent</span>.<span class="ActionScriptDefault_Text">xmin</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">initialExtent</span>.<span class="ActionScriptDefault_Text">ymin</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">max</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">initialExtent</span>.<span class="ActionScriptDefault_Text">ymin</span>, <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">fullExtent</span>.<span class="ActionScriptDefault_Text">ymin</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">initialExtent</span>.<span class="ActionScriptDefault_Text">xmax</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">min</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">initialExtent</span>.<span class="ActionScriptDefault_Text">xmax</span>, <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">fullExtent</span>.<span class="ActionScriptDefault_Text">xmax</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">initialExtent</span>.<span class="ActionScriptDefault_Text">ymax</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Math</span>.<span class="ActionScriptDefault_Text">min</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">initialExtent</span>.<span class="ActionScriptDefault_Text">ymax</span>, <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">fullExtent</span>.<span class="ActionScriptDefault_Text">ymax</span><span class="ActionScriptBracket/Brace">)</span>;

        <span class="ActionScriptASDoc">/**
         * This event is fired when the service and it&apos;s service info is loaded.
         * @name ArcGISMapService#load
         * @param {ArcGISMapService} service
         * @event
         */</span>
        <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">LOAD</span>, <span class="ActionScriptDefault_Text">me</span><span class="ActionScriptBracket/Brace">))</span>;
      <span class="ActionScriptBracket/Brace">}</span>

      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">error</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">correct_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">correct_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">augmentObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span>, <span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[]</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ids</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[]</span>;
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">layers</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">info</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;/&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">info</span>.<span class="ActionScriptDefault_Text">id</span>, <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">LayerOptions</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">initLoad</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">}))</span>;
          <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">augmentObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">info</span>, <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">info</span>.<span class="ActionScriptDefault_Text">defaultVisibility</span>;
          <span class="ActionScriptDefault_Text">layers</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptDefault_Text">ids</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">info</span>.<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">layers_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layers</span>;
        <span class="ActionScriptReserved">delete</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">layers</span>;

        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">spatialReference_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">SpatialReferences</span>.<span class="ActionScriptDefault_Text">getSpatialReference</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">spatialReference</span>.<span class="ActionScriptDefault_Text">wkid</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">spatialReference_</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bbox</span><span class="ActionScriptOperator">:*=</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">fullExtent</span>;
          <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">restRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;/export&apos;</span>, <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;json&apos;</span>, <span class="ActionScriptDefault_Text">bbox</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bbox</span>.<span class="ActionScriptDefault_Text">xmin</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bbox</span>.<span class="ActionScriptDefault_Text">ymin</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bbox</span>.<span class="ActionScriptDefault_Text">xmax</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bbox</span>.<span class="ActionScriptDefault_Text">ymax</span>, <span class="ActionScriptDefault_Text">bboxSR</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">spatialReference</span>.<span class="ActionScriptDefault_Text">wkid</span>, <span class="ActionScriptDefault_Text">size</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;1,1&apos;</span>, <span class="ActionScriptDefault_Text">imageSR</span><span class="ActionScriptOperator">:</span> 4326, <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;hide:&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">ids</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;,&apos;</span><span class="ActionScriptBracket/Brace">)}</span>, <span class="ActionScriptReserved">this</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">image</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
              <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FlatSpatialReference</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FlatSpatialReference</span><span class="ActionScriptBracket/Brace">({</span><span class="ActionScriptDefault_Text">wkid</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">spatialReference</span>.<span class="ActionScriptDefault_Text">wkid</span>, <span class="ActionScriptDefault_Text">latlng</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">image</span>.<span class="ActionScriptDefault_Text">extent</span>, <span class="ActionScriptDefault_Text">coords</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">fullExtent</span><span class="ActionScriptBracket/Brace">})</span>;
              <span class="ActionScriptDefault_Text">SpatialReferences</span>.<span class="ActionScriptDefault_Text">addSpatialReference</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">spatialReference</span>.<span class="ActionScriptDefault_Text">wkid</span>, <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptBracket/Brace">)</span>;
              <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">spatialReference_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">sr</span>;
              <span class="ActionScriptDefault_Text">doneLoad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">})</span>;
        <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">doneLoad</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>
    ;


    <span class="ActionScriptASDoc">/**
     * If this map service has finished loading from server.
     * @return {Boolean}
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">hasLoaded</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">loaded_</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
     * Get the Spatial Reference of this map service that can convert between LatLng and Coordinates
     * Note, if the actual spatial reference is not aleady added via {@link ArcGISSpatialReferences}, it will return an object literal with &lt;b&gt;wkid info only&lt;/b&gt;.
     * @return {ArcGISSpatialReference}
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getSpatialReference</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SpatialReference</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">spatialReference_</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
     * Get the Array of {@link ArcGISLayer}[] for this map service
     * @return {Layer[]}
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getLayers</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">layers_</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
     * Get a map layer by it&apos;s name(String) or id (Number), return {@link ArcGISLayer}.
     * @param {String|Number} nameOrId
     * @return {Layer}
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getLayer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nameOrId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">layers_</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layers</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nameOrId</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
          <span class="ActionScriptBracket/Brace">}</span>
          <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">nameOrId</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">String</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">name</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptDefault_Text">nameOrId</span>.<span class="ActionScriptDefault_Text">toLowerCase</span><span class="ActionScriptBracket/Brace">())</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
          <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
     * Get layer id or array of ids from a layer name or array of names.
     * @param {String|String[]} names
     * @return {Number|Number[]}
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getLayerIdsByName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">names</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ids</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[]</span>;
      <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">names</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">getLayer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">names</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">])</span>;
        <span class="ActionScriptDefault_Text">ids</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">ids</span>;
    <span class="ActionScriptBracket/Brace">}</span>




    <span class="ActionScriptASDoc">/**
     * Export an image with given parameters.
     * For more info see &lt;a  href  = &apos;http://resources.esri.com/help/9.3/arcgisserver/apis/rest/export.html&apos;&gt;Export Operation&lt;/a&gt;.
     * &lt;br/&gt; The &lt;code&gt;params&lt;/code&gt; is an instance of {@link ArcGISExportMapParameters}.
     * The following properties will be set automatically if not specified:...
     * &lt;br/&gt; The &lt;code&gt;callback&lt;/code&gt; is the callback function with argument of
     * an instance of {@link ArcGISMapImage}.
     * @param {ExportMapOptions} params
     * @param {Function} callback
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">exportMap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ImageParameters</span>, <span class="ActionScriptDefault_Text">callbackFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">failedFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptComment">// note: dynamic map may overlay on top of maptypes with different projection
</span>      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ps</span><span class="ActionScriptOperator">:*=</span><span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">f</span>, <span class="ActionScriptDefault_Text">size</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">height</span>, <span class="ActionScriptDefault_Text">dpi</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">dpi</span> <span class="ActionScriptOperator">||</span> 96, <span class="ActionScriptDefault_Text">format</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">format</span><span class="ActionScriptOperator">||</span><span class="ActionScriptDefault_Text">ArcGISConstants</span>.<span class="ActionScriptDefault_Text">IMAGE_FORMAT_PNG</span>, <span class="ActionScriptDefault_Text">transparent</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">transparent</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">}</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SpatialReference</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">imageSpatialReference</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">SpatialReferences</span>.<span class="ActionScriptDefault_Text">WEB_MERCATOR</span>;
      <span class="ActionScriptComment">// although AGS support different imageSR &amp; bboxSR, we only use one here.
</span>      <span class="ActionScriptDefault_Text">ps</span>.<span class="ActionScriptDefault_Text">imageSR</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">sr</span>.<span class="ActionScriptDefault_Text">wkid</span>;

      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">inSr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SpatialReference</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">sr</span>; <span class="ActionScriptComment">//SpatialReferences.WGS84
</span>      <span class="ActionScriptDefault_Text">ps</span>.<span class="ActionScriptDefault_Text">bboxSR</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">inSr</span>.<span class="ActionScriptDefault_Text">wkid</span>; <span class="ActionScriptComment">//sr.wkid;
</span>      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bbox</span><span class="ActionScriptOperator">:*=</span><span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">fromLatLngBoundsToEnvelope</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">bounds</span>, <span class="ActionScriptDefault_Text">inSr</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptDefault_Text">ps</span>.<span class="ActionScriptDefault_Text">bbox</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&apos;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bbox</span>.<span class="ActionScriptDefault_Text">xmin</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bbox</span>.<span class="ActionScriptDefault_Text">ymin</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bbox</span>.<span class="ActionScriptDefault_Text">xmax</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">bbox</span>.<span class="ActionScriptDefault_Text">ymax</span>;

      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">vlayers</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[]</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layerDefs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[]</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">changed</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span>;
      <span class="ActionScriptComment">// a special behavior of REST: if partial group then parent must be off
</span>      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>, <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span>;
      <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">layers_</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">layers_</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">subLayers</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">jc</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">subLayers</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">j</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">jc</span>; <span class="ActionScriptDefault_Text">j</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">subLayers</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">j</span><span class="ActionScriptBracket/Brace">]</span>.<span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
              <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
              <span class="ActionScriptReserved">break</span>;
            <span class="ActionScriptBracket/Brace">}</span>
          <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">c</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">layers_</span>.<span class="ActionScriptDefault_Text">length</span>; <span class="ActionScriptDefault_Text">i</span> <span class="ActionScriptOperator">&lt;</span> <span class="ActionScriptDefault_Text">c</span>; <span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">layers_</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">!==</span> <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">defaultVisibility</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">changed</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">visible</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">vlayers</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">id</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">definition</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">layerDefs</span>.<span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">id</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;:&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">definition</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">layerIds</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">layerOption</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">ps</span>.<span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">layerOption</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;:&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">layerIds</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;,&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">changed</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">ps</span>.<span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISConstants</span>.<span class="ActionScriptDefault_Text">LAYER_OPTION_SHOW</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;:&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">vlayers</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;,&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">layerDefinitions</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">ps</span>.<span class="ActionScriptDefault_Text">layerDef</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">layerDefinitions</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerDefs</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">ps</span>.<span class="ActionScriptDefault_Text">layerDefs</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layerDefs</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;;&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">me</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">vlayers</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">===</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptComment">// avoid an error:{&quot;error&quot;:{&quot;code&quot;:400,&quot;message&quot;:&quot;&quot;,&quot;details&quot;:[&quot;Invalid layer ID specified.&quot;]}
</span>        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapImage</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MapImage</span><span class="ActionScriptBracket/Brace">({})</span>;
        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">callbackFn</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">callbackFn</span>.<span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>, <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptBracket/Brace">)</span>;
        <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_COMPLETE</span>, <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptBracket/Brace">))</span>;

        <span class="ActionScriptReserved">return</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>

        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_START</span>, <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptBracket/Brace">))</span>;
        <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">restRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;/export&apos;</span>, <span class="ActionScriptDefault_Text">ps</span>, <span class="ActionScriptReserved">this</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapImage</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MapImage</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">callbackFn</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
              <span class="ActionScriptDefault_Text">callbackFn</span>.<span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>, <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_COMPLETE</span>, <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptBracket/Brace">))</span>;
          <span class="ActionScriptBracket/Brace">}</span>, <span class="ActionScriptDefault_Text">failedFn</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
     * Identify features on a particular ArcGISGeographic location, using {@link ArcGISIdenitfyParameters} and
     * process {@link ArcGISIdentifyResults} using the &lt;code&gt;callback&lt;/code&gt; function.
     * For more info see &lt;a
     * href  = &apos;http://resources.esri.com/help/9.3/arcgisserver/apis/rest/identify.html&apos;&gt;Identify Operation&lt;/a&gt;.
     * @param {IdentifyParameters} params
     * @param {Function} callback
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">identify</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iparams</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IdentifyParameters</span>, <span class="ActionScriptDefault_Text">callbackFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">failedFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">ovOpts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">OverlayOptions</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">iparams</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SpatialReference</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">sr</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">SpatialReferences</span>.<span class="ActionScriptDefault_Text">WGS84</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">:*=</span><span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">f</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptString">&apos;json&apos;</span>, <span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">returnGeometry</span>, <span class="ActionScriptDefault_Text">tolerance</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">tolerance</span>, <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">sr</span>.<span class="ActionScriptDefault_Text">wkid</span><span class="ActionScriptBracket/Brace">}</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ovs</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Array</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">:*</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">LatLng</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">ovs</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptBracket/Brace">]</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">ovs</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">geometry</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScripttrace">trace</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">geometry</span>.<span class="ActionScriptDefault_Text">toString</span><span class="ActionScriptBracket/Brace">())</span>;
      <span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">fromOverlaysToGeometry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ovs</span>, <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">fromGeometryToJSON</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geom</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">x</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">geometryType</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISConstants</span>.<span class="ActionScriptDefault_Text">GEOMETRY_POINT</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">points</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">geometryType</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISConstants</span>.<span class="ActionScriptDefault_Text">GEOMETRY_MULTIPOINT</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">rings</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">geometryType</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISConstants</span>.<span class="ActionScriptDefault_Text">GEOMETRY_POLYGON</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">paths</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">geometryType</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISConstants</span>.<span class="ActionScriptDefault_Text">GEOMETRY_POLYLINE</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">mapExtent</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">fromGeometryToJSON</span><span class="ActionScriptBracket/Brace">(A</span><span class="ActionScriptDefault_Text">rcGISUtil</span>.<span class="ActionScriptDefault_Text">fromLatLngBoundsToEnvelope</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">bounds</span>, <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptBracket/Brace">))</span>;
      <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">imageDisplay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">&apos;&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">width</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">height</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;,&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">dpi</span> <span class="ActionScriptOperator">||</span> 96<span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">layerOption</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptString">&apos;all&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;:&apos;</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">iparams</span>.<span class="ActionScriptDefault_Text">layerIds</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;,&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">me</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>;
      <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">restRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;/identify&apos;</span>, <span class="ActionScriptDefault_Text">params</span>, <span class="ActionScriptReserved">this</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IdentifyResults</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">IdentifyResults</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">callbackFn</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">callbackFn</span>.<span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>, <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptBracket/Brace">}</span>
          <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">IDENTIFY_COMPLETE</span>, <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptBracket/Brace">))</span>;
        <span class="ActionScriptBracket/Brace">}</span>, <span class="ActionScriptDefault_Text">failedFn</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
     * Find features using the {@link ArcGISFindParameters} and process {@link ArcGISFindResults}
     * using the &lt;code&gt;callback&lt;/code&gt; function.
     * For more info see &lt;a
     * href  = &apos;http://resources.esri.com/help/9.3/arcgisserver/apis/rest/find.html&apos;&gt;Find Operation&lt;/a&gt;.
     * @param {FindParameters} params
     * @param {Function} callback
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">find</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fparams</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FindParameters</span>, <span class="ActionScriptDefault_Text">callbackFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">failedFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">ovOpts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">OverlayOptions</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptDefault_Text">fparams</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">:*=</span><span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">f</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptString">&apos;json&apos;</span>, <span class="ActionScriptDefault_Text">searchText</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">searchText</span>, <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">SpatialReferences</span>.<span class="ActionScriptDefault_Text">WGS84</span>.<span class="ActionScriptDefault_Text">wkid</span>, <span class="ActionScriptDefault_Text">contains</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">contains</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span>, <span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">:</span> <span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">returnGeometry</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptReserved">false</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">}</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">layerIds</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">layerIds</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">layerIds</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;,&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">searchFields</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">searchFields</span>.<span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">searchFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">fparams</span>.<span class="ActionScriptDefault_Text">searchFields</span>.<span class="ActionScriptDefault_Text">join</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">&apos;,&apos;</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">me</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>;
      <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">restRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">&apos;/find&apos;</span>, <span class="ActionScriptDefault_Text">params</span>, <span class="ActionScriptReserved">this</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptOperator">:*</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">FindResults</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">FindResults</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">callbackFn</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">callbackFn</span>.<span class="ActionScriptDefault_Text">call</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>, <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptBracket/Brace">}</span>
          <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">FIND_COMPLETE</span>, <span class="ActionScriptDefault_Text">res</span><span class="ActionScriptBracket/Brace">))</span>;
        <span class="ActionScriptBracket/Brace">}</span>, <span class="ActionScriptDefault_Text">failedFn</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>


    <span class="ActionScriptASDoc">/**
     * Query a layer with given id or name using the {@link ArcGISQueryParameters} and process {@link ArcGISResultSet}
     * using the &lt;code&gt;callback&lt;/code&gt; function.
     * See {@link ArcGISLayer}.
     * For more info see &lt;a  href  = &apos;http://resources.esri.com/help/9.3/arcgisserver/apis/rest/query.html&apos;&gt;Query Layer Operation&lt;/a&gt;.
     * @param {Number|String} layerNameOrId
     * @param {QueryParameters} params
     * @param {Function} callback
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">queryLayer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerNameOrId</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">QueryParameters</span>, <span class="ActionScriptDefault_Text">callback</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>, <span class="ActionScriptDefault_Text">failedFn</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">getLayer</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerNameOrId</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">layer</span>.<span class="ActionScriptDefault_Text">query</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">params</span>, <span class="ActionScriptDefault_Text">callback</span>, <span class="ActionScriptDefault_Text">failedFn</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">ERROR</span>,
        <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceError</span><span class="ActionScriptBracket/Brace">(</span>
        <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">message</span><span class="ActionScriptOperator">:</span><span class="ActionScriptString">&quot;Can not find Layer:&quot;</span><span class="ActionScriptOperator">+</span><span class="ActionScriptDefault_Text">layerNameOrId</span><span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">)))</span>;
      <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>



    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">dispatcher_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">EventDispatcher</span>;

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">listener</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span>, <span class="ActionScriptDefault_Text">useCapture</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>, <span class="ActionScriptDefault_Text">priority</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>0, <span class="ActionScriptDefault_Text">useWeakReference</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>

      <span class="ActionScriptDefault_Text">dispatcher_</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span>, <span class="ActionScriptDefault_Text">listener</span>, <span class="ActionScriptDefault_Text">useCapture</span>, <span class="ActionScriptDefault_Text">priority</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">dispatcher_</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">hasEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">dispatcher_</span>.<span class="ActionScriptDefault_Text">hasEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span>, <span class="ActionScriptDefault_Text">listener</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Function</span>, <span class="ActionScriptDefault_Text">useCapture</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptDefault_Text">dispatcher_</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span>, <span class="ActionScriptDefault_Text">listener</span>, <span class="ActionScriptDefault_Text">useCapture</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">willTrigger</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">dispatcher_</span>.<span class="ActionScriptDefault_Text">willTrigger</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">type</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>
  <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
