<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>ArcGISMapOverlay.as</title>
<link rel="stylesheet" type="text/css" href="../../../../../../SourceStyles.css"/>
</head>

<body><pre><span class="ActionScriptComment">/*
 * ArcGIS for Google Maps Flash API
 *
 * License http://www.apache.org/licenses/LICENSE-2.0
 */</span> <span class="ActionScriptASDoc">/**
 * @author nianwei at gmail dot com
 */</span>

<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">extras</span>.<span class="ActionScriptDefault_Text">arcgislink</span> <span class="ActionScriptBracket/Brace">{</span>
  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptOperator">*</span>;
  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">interfaces</span>.<span class="ActionScriptOperator">*</span>;
  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span>.<span class="ActionScriptDefault_Text">google</span>.<span class="ActionScriptDefault_Text">maps</span>.<span class="ActionScriptDefault_Text">overlays</span>.<span class="ActionScriptDefault_Text">OverlayBase</span>;

  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">display</span>.<span class="ActionScriptOperator">*</span>;
  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">events</span>.<span class="ActionScriptOperator">*</span>;
  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">Point</span>;
  <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">net</span>.<span class="ActionScriptDefault_Text">URLRequest</span>;

  <span class="ActionScriptComment">//import mx.controls.Image;
</span>
  <span class="ActionScriptASDoc">/**
   * This is the UI component of an dynamic map service, used as an IOverlay.
   * It is implemented as an Image component overlay on top of base maps.
   */</span>
  <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">ArcGISMapOverlay</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">OverlayBase</span> <span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">minZoom_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">maxZoom_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Number</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">mapService_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">exportParams_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ImageParameters</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">drawing_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">redraw_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">map_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMap</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">fullBounds_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LatLngBounds</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">initialBounds_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LatLngBounds</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bounds_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LatLngBounds</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">moveend_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span>;
    <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">img_</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Sprite</span>;

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">ArcGISMapOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">service</span><span class="ActionScriptOperator">:*</span>, <span class="ActionScriptDefault_Text">opt_overlayOpts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArcGISMapOverlayOptions</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">super</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptDefault_Text">opt_overlayOpts</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArcGISMapOverlayOptions</span><span class="ActionScriptBracket/Brace">({})</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">service</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">service</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MapService</span> <span class="ActionScriptOperator">:</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">MapService</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">service</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">me</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArcGISMapOverlay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span>.<span class="ActionScriptDefault_Text">name</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">alpha</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span>.<span class="ActionScriptDefault_Text">alpha</span> <span class="ActionScriptOperator">||</span> 1;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">minZoom_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span>.<span class="ActionScriptDefault_Text">minResolution</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">maxZoom_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span>.<span class="ActionScriptDefault_Text">maxResolution</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">hasLoaded</span><span class="ActionScriptBracket/Brace">())</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">init_</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>

        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">LOAD</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">init_</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span><span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptBracket/Brace">})</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapEvent</span>.<span class="ActionScriptDefault_Text">OVERLAY_ADDED</span>, <span class="ActionScriptDefault_Text">onOverlayAdded</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapEvent</span>.<span class="ActionScriptDefault_Text">OVERLAY_REMOVED</span>, <span class="ActionScriptDefault_Text">onOverlayRemoved</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapEvent</span>.<span class="ActionScriptDefault_Text">MAPTYPE_CHANGED</span>, <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapZoomEvent</span>.<span class="ActionScriptDefault_Text">CONTINUOUS_ZOOM_START</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">evt</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">img_</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">img_</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
          <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">})</span>;

    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">init_</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArcGISMapOverlayOptions</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptComment">// this.opacity_  =  opt_overlayOpts.opacity || 1;
</span>      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">exportParams_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">opt_overlayOpts</span>.<span class="ActionScriptDefault_Text">imageParameters</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ImageParameters</span><span class="ActionScriptBracket/Brace">({})</span>;
      <span class="ActionScriptComment">// if the map imaging is been generated on server.
</span>      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">drawing_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
      <span class="ActionScriptComment">// if a follow up refresh is needed, normally cause by map view change before
</span>      <span class="ActionScriptComment">// the previous map has finished drawing.
</span>      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">redraw_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">img_</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">LOAD</span>, <span class="ActionScriptReserved">this</span><span class="ActionScriptBracket/Brace">))</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getDefaultPane</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IMap</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IPane</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">map_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">map</span>;
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">map</span>.<span class="ActionScriptDefault_Text">getPaneManager</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">getPaneById</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">PaneId</span>.<span class="ActionScriptDefault_Text">PANE_OVERLAYS</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptReserved">override</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">positionOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">zoomChanged</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">bounds_</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">img_</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">pane</span> <span class="ActionScriptOperator">!=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>

        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">nw</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">pane</span>.<span class="ActionScriptDefault_Text">fromLatLngToPaneCoords</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">bounds_</span>.<span class="ActionScriptDefault_Text">getNorthWest</span><span class="ActionScriptBracket/Brace">())</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">se</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">flash</span>.<span class="ActionScriptDefault_Text">geom</span>.<span class="ActionScriptDefault_Text">Point</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">pane</span>.<span class="ActionScriptDefault_Text">fromLatLngToPaneCoords</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">bounds_</span>.<span class="ActionScriptDefault_Text">getSouthEast</span><span class="ActionScriptBracket/Brace">())</span>;
        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">s</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">img_</span>;
        <span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">x</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">nw</span>.<span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">y</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">nw</span>.<span class="ActionScriptDefault_Text">y</span>;
        <span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">se</span>.<span class="ActionScriptDefault_Text">x</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">nw</span>.<span class="ActionScriptDefault_Text">x</span>;
        <span class="ActionScriptDefault_Text">s</span>.<span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">se</span>.<span class="ActionScriptDefault_Text">y</span> <span class="ActionScriptOperator">-</span> <span class="ActionScriptDefault_Text">nw</span>.<span class="ActionScriptDefault_Text">y</span>;
      <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onOverlayAdded</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">map_</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapMoveEvent</span>.<span class="ActionScriptDefault_Text">MOVE_END</span>, <span class="ActionScriptDefault_Text">onMapMoveEnd</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">img_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Sprite</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">img_</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">hasLoaded</span><span class="ActionScriptBracket/Brace">())</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onOverlayRemoved</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">removeChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">img_</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">map_</span>.<span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapMoveEvent</span>.<span class="ActionScriptDefault_Text">MOVE_END</span>, <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">)</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onMapMoveEnd</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapMoveEvent</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(!</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">hasLoaded</span><span class="ActionScriptBracket/Brace">()</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">map_</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">return</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">drawing_</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">redraw_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
        <span class="ActionScriptReserved">return</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">bnds</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LatLngBounds</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">map_</span>.<span class="ActionScriptDefault_Text">getLatLngBounds</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">prj</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">IProjection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">map_</span>.<span class="ActionScriptDefault_Text">getCurrentMapType</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">getProjection</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">SpatialReference</span>;
      <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">prj</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ArcGISTileConfig</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">prj</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ArcGISTileConfig</span><span class="ActionScriptBracket/Brace">)</span>.<span class="ActionScriptDefault_Text">getSpatialReference</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptDefault_Text">sr</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">SpatialReferences</span>.<span class="ActionScriptDefault_Text">WEB_MERCATOR</span>;
      <span class="ActionScriptBracket/Brace">}</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">img_</span>.<span class="ActionScriptDefault_Text">graphics</span>.<span class="ActionScriptDefault_Text">clear</span><span class="ActionScriptBracket/Brace">()</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">me</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ArcGISMapOverlay</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>;
      <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">params</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">ImageParameters</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">exportParams_</span>;
      <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">width</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">map_</span>.<span class="ActionScriptDefault_Text">getSize</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">x</span>;
      <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">height</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">map_</span>.<span class="ActionScriptDefault_Text">getSize</span><span class="ActionScriptBracket/Brace">()</span>.<span class="ActionScriptDefault_Text">y</span>;
      <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">bounds</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">bnds</span>;
      <span class="ActionScriptDefault_Text">params</span>.<span class="ActionScriptDefault_Text">imageSpatialReference</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">sr</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">drawing_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;

      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_START</span><span class="ActionScriptBracket/Brace">))</span>;
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">exportMap</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">params</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapImage</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
          <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_COMPLETE</span><span class="ActionScriptBracket/Brace">))</span>;
          <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">drawing_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
          <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">redraw_</span> <span class="ActionScriptOperator">===</span> <span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">redraw_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
            <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptReserved">return</span>;
          <span class="ActionScriptBracket/Brace">}</span>
          <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">href</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">bounds_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">fromEnvelopeToLatLngBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">extent</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">loader</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Loader</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Loader</span><span class="ActionScriptBracket/Brace">()</span>;
            <span class="ActionScriptDefault_Text">loader</span>.<span class="ActionScriptDefault_Text">contentLoaderInfo</span>.<span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span>.<span class="ActionScriptDefault_Text">COMPLETE</span>, <span class="ActionScriptfunction">function</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">img_</span>.<span class="ActionScriptDefault_Text">numChildren</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptBracket/Brace">{</span>
                  <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">img_</span>.<span class="ActionScriptDefault_Text">removeChildAt</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">img_</span>.<span class="ActionScriptDefault_Text">addChild</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">loader</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">img_</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">positionOverlay</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_LOAD</span><span class="ActionScriptBracket/Brace">))</span>;
              <span class="ActionScriptBracket/Brace">})</span>;
            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">request</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">json</span>.<span class="ActionScriptDefault_Text">href</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptDefault_Text">loader</span>.<span class="ActionScriptDefault_Text">load</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">request</span><span class="ActionScriptBracket/Brace">)</span>;
          <span class="ActionScriptBracket/Brace">}</span> <span class="ActionScriptReserved">else</span> <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptDefault_Text">me</span>.<span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ServiceEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ServiceEvent</span>.<span class="ActionScriptDefault_Text">EXPORTMAP_LOAD</span><span class="ActionScriptBracket/Brace">))</span>;
          <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">})</span>;
    <span class="ActionScriptBracket/Brace">}</span>



    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getMapService</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">MapService</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">fullBounds</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LatLngBounds</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fullBounds_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fullBounds_</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">fromEnvelopeToLatLngBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">fullExtent</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">fullBounds_</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">initialBounds</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">LatLngBounds</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">initialBounds_</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">initialBounds_</span> <span class="ActionScriptOperator">||</span> <span class="ActionScriptDefault_Text">ArcGISUtil</span>.<span class="ActionScriptDefault_Text">fromEnvelopeToLatLngBounds</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">initialExtent</span><span class="ActionScriptBracket/Brace">)</span>;
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">initialBounds_</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">hasLoaded</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptDefault_Text">Boolean</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">mapService_</span>.<span class="ActionScriptDefault_Text">hasLoaded</span><span class="ActionScriptBracket/Brace">()</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
    <span class="ActionScriptBracket/Brace">}</span>

    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">hide</span><span class="ActionScriptBracket/Brace">()</span><span class="ActionScriptOperator">:</span><span class="ActionScriptReserved">void</span> <span class="ActionScriptBracket/Brace">{</span>
      <span class="ActionScriptReserved">this</span>.<span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
    <span class="ActionScriptBracket/Brace">}</span>




  <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
